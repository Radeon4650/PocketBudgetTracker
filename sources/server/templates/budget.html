{% extends "base_page.html" %}

{% block content %}
<link rel="stylesheet" href="{{ static_url('css/table.css') }}" type="text/css">

<div class="box">
    <div class="title" style="text-align: center;">
        <label>Budget items by categories</label>
    </div>
    {% for category in current_user.categories %}
    <table class="ui_table">
        <caption>{{category.name}}</caption>
        <thead>
            <tr>
                <th scope="col">Number</th>
                <th scope="col">Date</th>
                <th scope="col">Title</th>
                <th scope="col">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% set i = 1 %}
            {% for budget in category.budgets %}
            <tr>
                <td>{{ i }}</td>
                <td>{{ budget.date }}</td>
                <td>{{ budget.title }}</td>
                <td currency={{ budget.currency }}>{{ str(budget.amount) }}</td>
            </tr>
            {% set i += 1 %}
            {% end %}
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" scope="row">Total:</th>
                <td currency={{ category.total_currency() }}>{{ category.sum() }}</td>
            </tr>
        </tfoot>
    </table>
    {% end %}
</div>

<div class="chartbox">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script>
    <canvas id="myChart" width="400" height="400"></canvas>
    <script type="application/javascript">
        var ctx = document.getElementById("myChart");
        var data_arr = [
            {% for category in current_user.categories %}
            "{{ category.sum() }}",
            {% end %}
        ];

        var labels_arr = [
            {% for category in current_user.categories %}
            "{{ category.name }}",
            {% end %}
        ];
        var myChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels_arr,
                datasets: [{
                    label: '# of Categories',
                    data: data_arr,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            }
        });
    </script>
</div>

<div class="rightBox">
    <form action="/budget" method="POST">

        {% set sel = 0 %}
        {% for category in current_user.categories %}

        {% if sel == 0 %}
        <input type="radio" name=category value={{ category.name }} checked> {{ category.name }}<br>
        {% set sel = 1 %}
        {% else %}
        <input type="radio" name=category value={{ category.name }}> {{ category.name }}<br>
        {% end %}
        {% end %}

        Title: <input name="title" type="text"><br>
        Amount: <input name="amount" type="text"><br>
        {% module xsrf_form_html() %}
        <input type="submit">
    </form>
</div>
{% end %}
